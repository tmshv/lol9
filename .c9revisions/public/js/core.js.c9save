{"ts":1350486057391,"silentsave":true,"restoring":false,"patch":[[]],"length":0}
{"contributors":[],"silentsave":true,"ts":1350486060273,"patch":[[{"diffs":[[1,"function Init(){\n  /*                            LOGIN WINDOW                    */\n  //Init vars\n  var user = jQuery('#user');\n  var loginwindow = jQuery('#login');\n  var loginemail = jQuery('#email');\n  var loginpassword = jQuery('#password');\n  var confirmationpassword = jQuery('#confirmationpassword');\n  var pagelogin = jQuery('#pagelogin');\n  var pageregister = jQuery('#pageregister');\n  var confirmationpassworddiv = jQuery('#confirmationpassworddiv');\n  var loginmsg = jQuery(jQuery('.msg',loginwindow)[0]);\n  var stayonline = jQuery('#stayonline');\n  confirmationpassworddiv.hide();\n  loginmsg.hide();\n  //Set events\n  confirmationpassword.keypress(inputkeypress);\n  loginpassword.keypress(inputkeypress);\n  loginemail.keypress(inputkeypress);\n  user.click(function(){    \n    loginwindow.fadeIn('fast');\n  });\n  jQuery('#logincancel').click(function(){\n    hidewindow();  \n  });\n  jQuery('#loginsbmt').click(function(){      \n      var isLogin = pagelogin.hasClass('active');\n      var error = false;\n      var errormsg = '';\n      if (loginemail.val()===''){\n          error = true;\n          loginemail.addClass('error');\n          errormsg += 'Type your email';\n      }else loginemail.removeClass('error'); \n      if (!isLogin){\n        if (loginpassword.val()===''){\n          error = true;\n          loginpassword.addClass('error');\n          errormsg += '<br/>Type your password';\n        }else loginpassword.removeClass('error');  \n        if (confirmationpassword.val()===''){\n          error = true;\n          confirmationpassword.addClass('error');\n          errormsg += '<br/>Type your confirmation password';\n        }else confirmationpassword.removeClass('error');  \n        if (confirmationpassword.val()!=loginpassword.val()){\n            error = true;    \n            confirmationpassword.addClass('error');\n            errormsg += '<br/>Password not same';\n        }\n      }\n      if (!error) {        \n        if (!isLogin)\n            registeruser();    \n        else\n            loginuser();\n      }else{\n        loginmsg.html(errormsg);\n        loginmsg.show();\n      }\n  });\n  jQuery('.back',loginwindow).click(function(){\n    hidewindow();  \n  });\n  pagelogin.click(function(){\n    pagelogin.addClass('active');\n    pageregister.removeClass('active');\n    confirmationpassworddiv.hide();  \n    loginmsg.hide();\n    jQuery('#loginsbmt').html('login');\n  });\n  pageregister.click(function(){\n    pagelogin.removeClass('active');\n    pageregister.addClass('active');\n    confirmationpassworddiv.show();  \n    loginmsg.hide();\n    jQuery('#loginsbmt').html('register');\n  });\n  //Check login state\n  checklogin();\n  //Other function\n  function inputkeypress(){\n    if (jQuery(this).val()!=='')\n        jQuery(this).removeClass('error');\n  }\n  //Hide login window and clear state\n  function hidewindow(){    \n    loginwindow.fadeOut('fast',function(){\n        loginmsg.hide();\n        confirmationpassword.removeClass('error');\n        loginpassword.removeClass('error'); \n        loginemail.removeClass('error'); \n        pagelogin.click();\n    });  \n  }\n  //Do login\n  function loginuser(){    \n    jQuery.ajax({\n      type: \"POST\",\n      url: \"/auth\",\n      data: { email: loginemail.val(), password: loginpassword.val(), stayonline: stayonline.val()==='1'}\n    }).done(function( msg ) {\n      loginpassword.val('');\n      if (msg.error){\n        loginmsg.html(msg.msg);\n        loginmsg.show();  \n      }else{          \n        jQuery.cookie('sessionid',msg.sessionid);\n        loginmsg.html(msg.msg);\n        loginmsg.show();  \n        setTimeout(function() {\n            hidewindow();\n            checklogin();\n        }, 1000);\n      }\n    });  \n  }\n  //Check login state\n  function checklogin(){\n    user.html('loading...');\n    jQuery.ajax({\n      type: \"GET\",\n      url: \"/auth\"\n    }).done(function( msg ) {\n        if (msg.error) {\n            user.html('login');\n            user.unbind('click');\n            user.click(function(){loginwindow.fadeIn('fast');});\n        } else {\n            user.html(msg.displayname);\n            user.unbind('click');\n            user.click(logout);\n        }\n            \n    });   \n  }\n  //Do log out\n  function logout(){\n    jQuery.ajax({\n      type: \"DELETE\",\n      url: \"/auth\"\n    }).done(function(msg){\n        if (msg.error){\n            alert(msg.msg);\n            return;\n        }\n        user.html('login');\n        user.unbind('click');\n        user.click(function(){    \n            loginwindow.fadeIn('fast');\n        });\n    });  \n  }\n  //Register new user\n  function registeruser(){\n   \n    jQuery.ajax({\n      type: \"POST\",\n      url: \"/auth/register\",\n      data: { email: loginemail.val(), password: loginpassword.val(), confirmationpassword:  confirmationpassword.val(), stayonline: stayonline.val()==='1'}\n    }).done(function( msg ) {\n      loginpassword.val('');\n      confirmationpassword.val('');        \n      if (msg.error){\n        loginmsg.html(msg.msg);\n        loginmsg.show();  \n      }else{\n        loginmsg.html(msg.msg);\n        loginmsg.show();  \n        setTimeout(function() {\n            hidewindow();\n            checklogin();\n        }, 1000);\n      }\n    });\n  }\n  /*                            LOGIN WINDOW                    */\n};"]],"start1":0,"start2":0,"length1":0,"length2":5253}]],"length":5253,"saved":false}
